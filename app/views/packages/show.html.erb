<% @title = "The " + @package.name + " package" %>

<h1><%= h @package.name %> <span class="version">(<%= @version.version%>)</span></h1>

<ul class="tags">
  <% @package.tags.each_with_index do |tag, i| %>
    <li<%= i.zero? ? ' class="first"' : "" %>>
      <%= link_to(tag, tag_path(tag)) %>
    </li>
  <% end %>
  <li>
    <%= link_to "Add tags", new_package_tagging_path(@package),
                              :class => "add", :id => "add-tag" %>
    <div id="add-tag-form" style="display:none;">
      <%= render :partial => "taggings/form",
                 :locals => { :tagging => @tagging } %>
    </div>
  </li>
</ul>
<%= render :partial => "versions/description" %>

<% if @package.versions.length > 1 %>
  <h2><%=h @package.name %> has <%= pluralize @package.versions.length - 1, "previous version" %></h2>

  <ul>
  <% for version in @package.versions[1..100] -%>
    <li>
      <%= link_to version.vname, [@package, version] %>.
      <% unless version.date.blank? -%>
      Released <%= time_ago_in_words version.date %> ago.
      <% end %>
    </li>
  <% end -%>
  </ul>
<% end %>

<h2>Rating:</h2>
<% if logged_in? %>
  <div>
    <% form_tag package_ratings_path(@package) do -%>
      <%= select_rating %>
    <% end %>
  </div>
<% else %>
  <%= select_rating(false) %>
<% end %>
  &nbsp; <%= @package.average_rating %>/5
  (<%= pluralize(@package.package_ratings.size.to_s, " vote") %>)

<% if logged_in? && r = current_user.rating_for(@package) %>
  <span style='color:red;font-style:italic'>You voted <%= r.rating %></span>
<% end %>

<%= clear_div -%>
<br />
<h2>Reviews</h2>

<% if @package.reviews.length == 0 %>
  <p>
    No one has written a review of <%= @package.name %> yet.
    Want to be the first?
    <%= link_to "Write one now.",
          new_package_version_review_path(@package, @package.latest) %>
  </p>
<% else -%>
  <ul>
  <% for review in @package.reviews %>
    <li>
      <p><strong><%= h review.title %></strong></p>
      <p><%= textilize(truncate(review.review, :length => 150)) %></p>
      <p><%= link_to review.user.login, review.user  %> gave
        <%= link_to review.package.name, review.package %> a
        <%= h review.rating %>.

        <%= link_to "Read the full review", package_review_path(review.package, review) %>.
      </p>
    </li>
  <% end %>
</ul>
  <div class="float-r"><%= link_to "Write a review",
                             new_package_version_review_path(@package, @package.latest) %></div>
  <%= clear_div -%>
<% end -%>

<hr />
<p><strong>Search for</strong> <%= @package.name %> on <%= link_to "google", @package.google_url %>, <%= link_to "google scholar", @package.scholar_url %>, <%= link_to "r-help", @package.rhelp_url %>, <%= link_to "r-devel", @package.rdevel_url %></p>
