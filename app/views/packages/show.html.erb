<h1><%= package_version(@package, @package.latest, false) %></h1>

<div class="float-r">
  <%= render :partial => "package_vote", :object => @package %>
</div>

<ul class="tags">
  <%= tag_list %>
  <li>
    <%= link_to "Add tags", new_package_tagging_path(@package),
        :class => "add", :id => "add-tag" %>
    <div id="add-tag-form" style="display:none;">
      <%= render :partial => "taggings/form",
          :locals => { :tagging => @tagging } %>
    </div>
  </li>
</ul>
<%= render :partial => "versions/description" %>

<% if @package.versions.length > 1 %>
  <h2><%= pluralize @package.versions.length - 1, "previous version" %></h2>

  <ul>
    <% for version in @package.versions[1..100] -%>
      <li>
        <%= link_to version.vname, [@package, version] %>.
        <% unless version.date.blank? -%>
          Released <%= time_ago_in_words version.date %> ago.
        <% end %>
      </li>
    <% end -%>
  </ul>
<% end %>

<br />
<h2>Ratings</h2>

<table>
  <tr>
    <td style="width: 140px;"><h3>Overall:</h3></td>
    <td style="vertical-align: top;">
      <div>
        <% form_tag package_ratings_path(@package) do -%>
          <%= select_rating %>
        <% end %>
      </div>&nbsp;
      <span id="overall-rating">
        <%= @package.average_rating -%>/5
        (<%= pluralize(@package.rating_count.to_s, "vote") -%>)
      </span>

      <br />
      <span class="your-rating">
      <% if logged_in? && r = current_user.rating_for(@package) %>
        You voted <%= r.rating %>
      <% end %>
      </span>
    </td>
  </tr>
  <tr>
    <td style="width: 140px;"><h3>Documentation:</h3></td>
    <td style="vertical-align: top;">
      <div>
        <% form_tag package_ratings_path(@package) do -%>
          <%= select_rating("documentation") %>
        <% end %>
      </div>
      &nbsp;
      <span id="documentation-rating"><%= @package.average_rating("documentation") %>/5
        (<%= pluralize(@package.rating_count("documentation").to_s, " vote") %>)</span>

      <br />
      <span class="your-rating">
      <% if logged_in? && r = current_user.rating_for(@package, "documentation") %>
        You voted <%= r.rating %>
      <% end %>
      </span>
    </td>
  </tr>
</table>

<%- unless logged_in? -%>
  <p><%= link_to "Log in", login_path %> to vote.</p>
<%- end -%>

<h2>Reviews</h2>

<% if @package.reviews.length == 0 %>
  <p>
    No one has written a review of <%= @package.name %> yet.
    Want to be the first?
    <%= link_to "Write one now.",
        new_package_version_review_path(@package, @package.latest) %>
  </p>
<% else -%>
  <ul>
    <% for review in @package.reviews %>
      <li>
        <p><strong><%= h review.title %></strong></p>
        <p><%= textilize(truncate(review.review, :length => 150)) %></p>
        <p><% if review.rating %>
            <%= link_to review.user.login, review.user  %> gave
            <%= package_version(review.package, review.version) %> a
            <%= h review.rating %>.
          <% else %>
            <%= link_to review.user.login, review.user %> did not rate
            <%= package_version(review.package, review.version) -%>.
          <% end %>
          <%= link_to "Read the full review", package_review_path(review.package, review) %>.
        </p>
      </li>
    <% end %>
  </ul>
  <div class="float-r"><%= link_to "Write a review",
                           new_package_version_review_path(@package, @package.latest) %></div>
  <%= clear_div -%>
<% end -%>

<hr />
<p><strong>Search for</strong> <%= @package.name %> on <%= link_to "google", @package.google_url %>, <%= link_to "google scholar", @package.scholar_url %>, <%= link_to "r-help", @package.rhelp_url %>, <%= link_to "r-devel", @package.rdevel_url %></p>
